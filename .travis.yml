language: python
python:
- '3.4'
addons:
  apt:
    packages:
    - enchant
cache:
  directories:
  - "$HOME/.cache/pip"
  pip: true
  timeout: 86400
before_cache:
- rm -f $HOME/.cache/pip/log/debug.log
install:
- pip install -r requirements.txt
- npm install webpagetest -g
script:
- nikola build
- fab spellchecker
- ci/deploy.sh staging
- fab w3c_checks
- webpagetest test https://staging.wordspeak.org --key=$WEBPAGETEST_API_KEY --location=ec2-ap-southeast-2:Chrome
  --clearcerts --first --poll --timeout 570 --specs ci/wpt_frontpage_testspecs.json
  --reporter spec
notifications:
  email:
    recipients:
    - edwin@wordspeak.org
  pushover:
    on_success: always
    on_failure: always
    api_key:
      secure: hPTvigjDJHe+AmoY7diE3V0qNQAV56zfH6fw8ZxFd8XcceKBmXm5HpdXEl7V9hdh+xBUW0Jz1/FSaSHuWJoteAUE2ABx4ISjEaud1hvVH9QLQSuNWIfcQGsRKTO2V1Dybd20sKc1oyluj/0gs+eyIYae1O81RUEGsRzES01auC+I0MjXVRZBtq5cDnjYhbN/250Bby4RXW2q+1e6Tn5hIaoLITukpYQqOxy2uCJQ9KHRmy3sBj4mSv4gNA5RcaV9N9OqPN3KcHVqmFMxPrfP/ZSv6XB57wT0lyi8fElhUM+yFPzjCYQF1izIxnutL/vNKfozGipfEuelUWiQzfVX3tOKMgt/1zZt1ArIdGK5wCy4opTEQ7b3NwUeOfnpO0DBSX3B3WM9ux5osNQhf5DL2GBZSmyebOOcYz2QZ47KKJZZ8Frc18a4LongASN6ZhKwOr0CEOGFiMG+NcThunOpOYypzF1pE+e/myny6qtEUNWJNA9+M2UQF1d8szV3dXskVUpFl48QCI4JL3rslBbeQcpuJrxl0ghB2UhdF98QDnLPBoST8Zx8ch7/Jg0YNeot2bQNDe/de8OcWO7tRSpWQGT7d3wyq9T9JUq/vODmJdeYK3ugXCRs5lsPnu00lRrAlafPah3SVgcRSBYRZ0/zOo0KA77QlH/QrXnpPthUUC8=
    users:
      secure: TRDaNchMd1zUtviPy0Nt2HZN43s1z6AWERlxU94wSNjM+/NgI5rzefUsuo8A46pGqttGaSxDtsEHv5/alcsvHxyB9jqlp5RTIalqH6I1waWSMXGW6PGN++z6a8nX+NTOIlGBmXPBN4h0oUZ5jH2mMgCWl/u9JRPJewY7f8DyViYB+ugxgMLWD3lrcgzgaacPd65DLzYZZXqB/8SGmOdnvzJvzAMY8t7CbD8K9w9/KKPz7a8+JawiOUEUKK/eVqBlb+0G1vFT282brebvMTTg5xvMMGxd6VcWmXoyS8XgDklOjZJVR/IkjDhplqhnUy3C2bgvxqMAdRhS35itbFPTNNCK/V427G3UPGbWeBoB40U39PpvY8q2OP10P62Xh2z6zFjiOHFzt6iTvfhRzsKin00UZGbiDJ6f4J3pEtcxmpd7g9R+wd65nkwHlt0i8vFFWFS/yMvtHdG0eqTjAkDxkxUFunhCQfG5CXi1jaygzjx4xxz06kSibvVH2jTmkC3HOgFHhIf6WjA8r2UI1C9KF1X/BToIb5F4ZjOgRFgrMTOJR8bGkIUT7O4UMRScsNsK8NB+dq3lu9ILsWZHe0uDNZRxqtokqCAqibQjkAY45AeKv45iLb/OVkwbxkMLSakSeYLkr+QDKg8XVR55zBRvf6s5kSkNHC3FgMBD0R/Wpys=
env:
  global:
  - secure: eeupNNeHmMUKWBlQioZpg5X1wa4C0JMqZ46hN1kaDebdhY85UzMbiQtYRTx2N2fA+XA4AbKgCH/iofM81wMq2uhawZZWfi5L88pD3Bs+mqpNip1U219b6yEzvNms3OA/CfuCZgCtmQxcwClT7/738D0YQ3r5+BQGL5neU0QRShoLeAFb948Y839uQPw3m/iWLaayPwH6j9BmxuKxfgCTpLIQa3iePFwVmlAU0tbFQCJMfh7GhMfivlDcfBb3cdUQO8RBPOOuJM3H/3JMIrHDl/cR07hk8r7fx/+v2l2x4x1sY9Cgqf9lV71d/gtohKVrk5XwjHvsAieU7s0uTOUVVe40yazoEt3ndOmjW3pjXVqDN9HYYAG+vhBrAuuBxxeqJ9mi5hUI2QGLJHB8ykUuTTZNiFitTCkqKvm0uaX9H3aE71vZaxKNofW060xBN2ZreA6qWdXZdwQwh5vOfvfutwIW32Wg0uU6JxkG/vVcp9xWi/xurlnYFgwt/oDmr5j8BfZPxk1YSW5yyjS8pSGERBktXpv5gsbWmCGNGO46Ly1N/S6zNZjjuZbrec+bkr7QtQCG367GcCYF0SA/3IXzGOw3skH7BV2CxqAJuKH3jY3/dSntuxDrpWWKQBwbF9tpOpPUoV8g2K1KGHQvaj4A4473ca0/lyApi36/GdcCcOU=
deploy:
- provider: script
  script: ci/deploy.sh prod
  on:
    branch: master
